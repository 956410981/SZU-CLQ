<div id="content"></div>

<script>
  async function loadConfig() {
    const res = await fetch("config.json");
    const data = await res.json();
    const content = document.getElementById("content");

    for (const [topic, years] of Object.entries(data)) {
      const detailsTopic = document.createElement("details");
      const summaryTopic = document.createElement("summary");
      summaryTopic.textContent = topic;
      detailsTopic.appendChild(summaryTopic);

      for (const [year, papers] of Object.entries(years)) {
        const detailsYear = document.createElement("details");
        const summaryYear = document.createElement("summary");
        summaryYear.textContent = year;
        detailsYear.appendChild(summaryYear);

        const ulPapers = document.createElement("ul");
        papers.forEach(paper => {
          const li = document.createElement("li");

          const title = document.createElement("div");
          title.textContent = paper.title;

          const links = document.createElement("div");
          links.style.marginLeft = "15px";
          const aPaper = document.createElement("a");
          aPaper.href = paper.paper;
          aPaper.target = "_blank";
          aPaper.textContent = "Paper";
          aPaper.style.marginRight = "10px";

          const aPPT = document.createElement("a");
          aPPT.href = paper.ppt;
          aPPT.target = "_blank";
          aPPT.textContent = "PPT";

          links.appendChild(aPaper);
          links.appendChild(aPPT);

          li.appendChild(title);
          li.appendChild(links);
          ulPapers.appendChild(li);
        });

        detailsYear.appendChild(ulPapers);
        detailsTopic.appendChild(detailsYear);
      }

      content.appendChild(detailsTopic);
    }
  }

  // 搜索功能：同时搜索标题和年份
  document.getElementById("searchBox").addEventListener("input", function() {
    const keyword = this.value.toLowerCase();
    const detailsList = document.querySelectorAll("#content details");

    detailsList.forEach(topicDetails => {
      let topicMatch = topicDetails.querySelector("summary").textContent.toLowerCase().includes(keyword);
      let yearMatch = false;

      const yearDetails = topicDetails.querySelectorAll("details");
      yearDetails.forEach(yearDetail => {
        let yearText = yearDetail.querySelector("summary").textContent.toLowerCase();
        let paperMatch = false;

        yearDetail.querySelectorAll("li").forEach(li => {
          const title = li.querySelector("div").textContent.toLowerCase();
          const match = title.includes(keyword) || yearText.includes(keyword);
          li.style.display = match ? "list-item" : "none";
          if (match) paperMatch = true;
        });

        yearDetail.style.display = paperMatch ? "block" : "none";
        if (paperMatch) yearMatch = true;
      });

      topicDetails.style.display = topicMatch || yearMatch ? "block" : "none";
    });
  });

  loadConfig();
</script>
